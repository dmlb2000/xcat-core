=head1 NAME

B<mkdsklsnode> - Use this xCAT command to define and initialize AIX/NIM diskless machines.

=head1 SYNOPSIS

B<mkdsklsnode [-h|--help ]>

B<mkdsklsnode [-V|--verbose] [-f|--force] [-n|--newname] [-i osimage_name] noderange [attr=val [attr=val ...]]>

=head1 DESCRIPTION

This xCAT command can be used to define and/or initialize AIX/NIM diskless machines. Once this step is completed the xCAT rnetboot command may be used to initiate a network boot of the nodes.

The command can be used to define and initialize a new NIM machine object or it may be used to reinitialize an existing machine to use a different operating system image.

When creating a new NIM machine definition the default is to use the same name as the xCAT node name that is provided.

You can use the "-n" option of the mkdsklsnode command to create and initialize an alternate NIM machine definition for the same physical nodes. This option allows you to set up a new image to use when a node is next rebooted while the node is currently running.  This is possible because the NIM name for a machine definition does not have to be the hostname of the node.  This allows you to have multiple NIM machine definitions for the same physical node. The naming convention for the new NIM machine name is "<xcat_node_name>_<image_name>", (Ex. "node01_61spot"). Since all the NIM initialization can be done while the node is running the downtime for for the node is reduced to the time it takes to reboot.

You can use the force option to reinitialize a node if it already has resources allocated or it is in the wrong NIM state. This option will reset the NIM node and deallocate resources before reinititializing. Use this option with caution since reinitializing a node will stop the node if it is currently running.

After the mkdsklsnode command completes you can use the lsnim command to check the NIM node definition to see if it is ready for booting the node. ("lsnim -l <nim_node_name>").

You can supply your own scripts to be run on the mn or on the service node (if their is hierarchy) for a node during the mkdsklsnode command. Such scripts are called B<prescripts>. They should be copied to /install/prescripts dirctory. A table called I<prescripts> is used to specify the scripts and their associated actions. The scripts to be run at the beginning of the mkdsklsnode command are stored in the 'begin' column of I<prescripts> table. The scripts to be run at the end of the mkdsklsnode command are stored in the 'end' column of I<prescripts> table. Please run 'tabdump prescripts -d' command for details. An example for the 'begin' or the 'end' column is: I<diskless:myscript1,myscript2>. The following two environment variables will be passed to each script: NODES contains all the names of the nodes that need to run the script for and ACTION contains the current current nodeset action, in this case "diskless". If I<#xCAT setting:MAX_INSTANCE=number> is specified in the script, the script will get invoked for each node in parallel, but no more than I<number> of instances will be invoked at at a time. If it is not sepcified, the script will be invoked once for all the nodes.


=head1 OPTIONS

=over 10

=item B<attr=val [attr=val ...]>

Specifies one or more "attribute equals value" pairs, separated by spaces. Attr=
val pairs must be specified last on the command line. These are used to specify additional values that can be passed to the underlying NIM commands.

Valid values:

=over 3

=item B<duplex>

Specifies the duplex setting (optional). Used when defining the NIM machine. Use this setting to configure the client's network interface. This value can be full or half. The default is full. (ex. "duplex=full")

=item B<speed>

Specifies the speed setting (optional). Used when defining the NIM machine. This is the communication speed to use when configuring the client's network interface. This value can be 10, 100, or 1000. The default is 100. (ex. "speed=100")

=item B<psize>

Specifies the size in Megabytes of the paging space for the diskless node.(optional) Used when initializing the NIM machine. The minimum and default size is 64 MB of paging space. (ex. "psize=256")

=item B<sparse_paging>

Specifies that the paging file should be created as an AIX sparse file, (ex. "sparse_paging=yes").  The default is "no".

=item B<dump_iscsi_port>

The tcpip port number to use to communicate dump images from the client to the dump	resource server. Normally set by default. This port number is used by a dump resource server.

=item B<configdump>

Specifies the type dump to be collected at the client.  The values are "selective", "full", and	"none".  If the configdump attribute is set to "full" or "selective" the client will automatically be setup to dump to an iSCSI Target device. The "selective" memory dump will avoid dumping user data. The "full" memory dump will dump all the memory of the client partition. Selective and full memory dumps will be collected in the dump resource allocated to the client. Only POWER6 clients an dump to the dump resource.

=back

=item B<-f |--force>

Use the force option to reinitialize the NIM machines.

=item B<-h |--help>

Display usage message.

=item B<-i image_name>

The name of an existing xCAT osimage definition. If this information is not provided on the command line the code checks the node definition for the value of the "profile" attribute. If the "-i" value is provided on the command line then that value will be used to set the "profile" attribute of the node definiions.

=item B<-n|--newname>

Create a new NIM machine object name for the xCAT node. Use the naming convention "<xcat_node_name>_<image_name>" for the new NIM machine definition.

=item B<noderange>

A set of comma delimited node names and/or group names. See the "noderange" man page for details on additional supported formats.

=item B<-V |--verbose>

Verbose mode.

=back

=head1 RETURN VALUE

=over 3

=item 0

The command completed successfully.

=item 1

An error has occurred.

=back

=head1 EXAMPLES

=over 3

=item 1

Initialize an xCAT node named "node01" as an AIX diskless machine.  The xCAT osimage named "61spot" should be used to boot the node.

B<mkdsklsnode -i 61spot node01>

=item 2

Initialize all AIX diskless nodes contained in the xCAT node group called "aixnodes" using the image definitions pointed to by the "profile" attribute of the xCAT node definitions.

B<mkdsklsnode aixnodes>

=item 3

Initialize diskless node "clstrn29" using the xCAT osimage called "61dskls".  Also set the paging size to be 128M and specify the paging file be an AIX sparse file.

B<mkdsklsnode -i 61dskls clstrn29 psize=128 sparse_paging=yes>

=item 4

Initialize an xCAT node called "node02" as an AIX diskless node.  Create a new NIM machine definition name with the osimage as an extension to the xCAT node name.

B<mkdsklsnode -n -i 61spot node02>

=back

=head1 FILES

/opt/xcat/bin/mkdsklsnode

=head1 NOTES

This command is part of the xCAT software product.

=head1 SEE ALSO

L<rmdsklsnode(1)|rmdsklsnode.1>


