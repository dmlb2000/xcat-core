=head1 NAME

B<mkvm> - Creates HMC- and IVM-managed partitions or other virtual machines.

=head1 SYNOPSIS

=head2 Common:

I<mkvm [-h| --help]>

I<mkvm [-v| --version]>

=head2 For PPC (with HMC):

I<mkvm [-V| --verbose] noderange -i id -l singlenode>

I<mkvm [-V| --verbose] noderange -c destcec -p profile>

I<mkvm [-V| --verbose] noderange --full>

=head2 For PPC (using Direct FSP Management):

I<mkvm noderange -i id -m memory_interleaving -r partition_rule>

=head2 For KVM:

I<mkvm noderange -m|--master mastername -s|--size disksize -f|--force>

=head1 DESCRIPTION

=head2 For PPC:

For PPC (with HMC) specific:

The first form of mkvm command creates new partition(s) with the same profile/resources as the partition specified by I<singlenode>. The -i and I<noderange> specify the starting numeric partition number and the noderange for the newly created partitions, respectively. The LHEA port numbers and the HCA index numbers will be automatically increased if they are defined in the source partition. 

The second form of this command duplicates all the partitions from the source specified by I<profile> to the destination specified by I<destcec>. The source and destination CECs can be managed by different HMCs.

Please make sure the nodes in the I<noderange> is defined in the I<nodelist> table and the I<mgt> is set to 'hmc' in the I<nodehm> table before running this command.

Please note that the mkvm command currently only supports creating standard LPARs, not virtual LPARs working with VIOS server.

For PPC (without HMC, using Direct FSP Management) specific:

This feature is only for P7 IH. mkvm is designed to  set the Octant configure value to split the CPU and memory for partitions, and set Octant Memory interleaving value. The mkvm will only set the pending attributes value. After mkvm, the CEC needs to be rebooted manually for the pending values to be enabled. Before reboot the cec, the administrator can use mkvm to change the partition plan. If the the partition needs I/O slots, the administrator should use chvm to assign the I/O slots.

=head2 For KVM:

mkvm ....

=head1 OPTIONS

=over 10

=item B<-h|--help>       Display usage message.

=item B<-c>              The cec (fsp) name for the destination.

=item B<-i>              Starting numeric id of the newly created partitions. For P7 IH using Direct FSP Management, the id value only could be 1, 5, 9, 13, 17, 21, 25 and 29.

=item B<-m>              memory interleaving. The value only could be interleaved or non-interleaved. non-interleaved mode means the memory cannot be shared across the processors in an octant. interleaved means the memory can be shared.

=item B<-r>              partition rule.

If all the octants configuration value are same in one CEC,  it will be  " -r  0-7:value" .

If the octants use the different configuration value in one cec, it will be "-r 0:value1,1:value2,...7:value7", or "-r 0:value1,1-7:value2" and so on.

The octants configuration value for one Octant could be  1, 2, 3, 4, 5 . The meanings of the octants configuration value  are as following:

 1 - 1 partition with all cpus and memory of the octant
 2 - 2 partitions with a 50/50 split of cpus and memory
 3 - 3 partitions with a 25/25/50 split of cpus and memory
 4 - 4 partitions with a 25/25/25/25 split of cpus and memory
 5 - 2 partitions with a 25/75 split of cpus and memory

=item B<-l>              The partition name of the source.

=item B<-p>              The file that contains the profiles for the source partitions.

=item B<--full>          Request to create a new full system partition for each CEC.

=item B<-v|--version>    Command Version.

=item B<-V|--verbose>    Verbose output.

=back

=head1 RETURN VALUE

0 The command completed successfully.

1 An error has occurred.

=head1 EXAMPLES

1. To create a new partition lpar5 based on the profile/resources of lpar4, enter:

I<mkdef -t node -o lpar5 mgt=hmc groups=all>

then:

I<mkvm lpar5 -i 5 -l lpar4>

Output is similar to:

lpar5: Success


2. To create new partitions lpar5-lpar8 based on the profile/resources of lpar4, enter:

I<mkdef -t node -o lpar5-lpar8 mgt=hmc groups=all>

then:

I<mkvm lpar5-lpar8 -i 5 -l lpar4>

Output is similar to:

lpar5: Success

lpar6: Success

lpar7: Success

lpar8: Success


3. To duplicate all the partitions associated with cec01 on cec02, first save the lpars from cec01 to a file:

I<lsvm lpar01-lpar04> > I</tmp/myprofile> 

then create lpars on cec02:

I<mkvm lpar05-lpar08 -c cec02 -p /tmp/myprofile>

Output is similar to:

lpar5: Success

lpar6: Success

lpar7: Success

lpar8: Success


4. To duplicate all the partitions associated with cec01 on cec02, one is for cec01, the other is for cec02:

I<mkdef -t node -o lpar5,lpar6 mgt=hmc groups=all>

I<chtab node=lpar5 ppc.parent=cec01>

I<chtab node=lpar6 ppc.parent=cec02>

then create lpars on cec01 and cec02:

I<mkvm lpar5,lpar6 --full>

Output is similar to:

lpar5: Success

lpar6: Success

5. For P7 IH, to create a new partition lpar1 on the first octant of the cec, lpar1 will use all the cpu and memory of the octant 0, enter: 

 mkdef -t node -o lpar1 mgt=fsp groups=all parent=cec01   nodetype=lpar   hcp=cec01

then:

 mkvm lpar1 -i 1 -m non-interleaved -r 0:1

Output is similar to:

 par1: Success
 cec1: Please reboot the CEC cec1 firstly, and then use chvm to assign the I/O slots to the LPARs

6. For P7 Ih, to create new partitions lpar1-lpar8 on the whole cec, each LPAR will use all the cpu and memory of each octant, enter:

 mkdef -t node -o lpar1-lpar8 nodetype=lpar  mgt=fsp groups=all parent=cec01  hcp=cec01

then:

 mkvm lpar1-lpar8 -i 1 -m non-interleaved  -r 0-7:1

Output is similar to:

 lpar1: Success
 lpar2: Success
 lpar3: Success
 lpar4: Success
 lpar5: Success
 lpar6: Success
 lpar7: Success
 lpar8: Success
 cec1: Please reboot the CEC cec1 firstly, and then use chvm to assign the I/O slots to the LPARs

7. For P7 IH, to create new partitions lpar1-lpar9, the lpar1 will use 25% CPU and 25% memory of the first octant, and lpar2 will use the left CPU and memory of the first octant. lpar3-lpar9 will use all the cpu and memory of each octant, enter:

 mkdef -t node -o lpar1-lpar9 mgt=fsp groups=all parent=cec1   nodetype=lpar   hcp=cec1

then:

 mkvm lpar1-lpar9 -i 1 -m non-interleaved  -r 0:5,1-7:1

Output is similar to: 

 lpar1: Success
 lpar2: Success
 lpar3: Success
 lpar4: Success
 lpar5: Success
 lpar6: Success
 lpar7: Success
 lpar8: Success
 lpar9: Success
 cec1: Please reboot the CEC cec1 firstly, and then use chvm to assign the I/O slots to the LPARs

=head1 FILES

/opt/xcat/bin/mkvm


=head1 SEE ALSO

L<chvm(1)|chvm.1>, L<lsvm(1)|lsvm.1>, L<rmvm(1)|rmvm.1>




