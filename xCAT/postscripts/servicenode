#!/usr/bin/perl
# IBM(c) 2007 EPL license http://www.eclipse.org/legal/epl-v10.html
#egan@us.ibm.com
#(C)IBM Corp

#

#-----------------------------------------------------------------------------

=head1   servicenode 

 This updates the service node with files necessary to access the 
 database on the MasterNode and restarts the xcat daemon

=cut

#-----------------------------------------------------------------------------

#
#  remove OpenIPMI-tools and tftp
#  install xcat from /install/xcat
#  Copy Certificates, and config file to apprpriate directories from /install
#  and restart postgresql and xcatd
#
my $msg = "Removing OpenIPMI-tools";
`logger -t xcat $msg`;
`rpm -e OpenIPMI-tools`;
$msg = "Removing tftp";
`logger -t xcat $msg`;
`rpm -e tftp-server`;
if ($ENV{'NODESETSTATE'} eq "install") {
  $msg = "Installing xCAT";
 `logger -t xcat $msg`;
  `rpm -ivh /xcatpost/xcat/RPMS/*/*.rpm`;
}
$msg = "copying certificates and restarting daemon";
`logger -t xcat $msg`;
`/opt/xcat/sbin/copycerts`;

exit 0;

